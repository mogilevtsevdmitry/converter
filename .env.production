# ============================================
# PRODUCTION CONFIG FOR 4x P100 GPU SERVER
# GPU: 4x P100 16GB NVLINK
# CPU: E5-2660v3 (10 cores / 20 threads)
# RAM: 64GB
# ============================================

# ============================================
# POSTGRESQL SETTINGS
# ============================================
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_ME_PRODUCTION_PASSWORD
POSTGRES_DB=converter
POSTGRES_PORT=5455

DATABASE_URL=postgres://postgres:CHANGE_ME_PRODUCTION_PASSWORD@localhost:5455/converter?sslmode=disable
DATABASE_MAX_OPEN_CONNS=50
DATABASE_MAX_IDLE_CONNS=10

# ============================================
# MINIO SETTINGS
# ============================================
MINIO_ROOT_USER=CHANGE_ME_MINIO_USER
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001

S3_ENDPOINT=http://localhost:9000
S3_REGION=us-east-1
S3_ACCESS_KEY=CHANGE_ME_MINIO_USER
S3_SECRET_KEY=CHANGE_ME_MINIO_PASSWORD
S3_BUCKET_OUTPUT=converted
S3_USE_SSL=false

# ============================================
# TEMPORAL SETTINGS
# ============================================
TEMPORAL_PORT=7233
TEMPORAL_UI_PORT=8088
TEMPORAL_ADDRESS=localhost:7233
TEMPORAL_NAMESPACE=default
TEMPORAL_TASK_QUEUE=video-conversion

# ============================================
# API SETTINGS
# ============================================
API_PORT=8080
API_READ_TIMEOUT=60s
API_WRITE_TIMEOUT=60s

# ============================================
# WORKER SETTINGS - OPTIMIZED FOR 4x P100
# ============================================
WORKER_PORT=9091

# Resource Limits (NO LIMITS on dedicated server)
WORKER_CPU_LIMIT=20          # All CPU threads
WORKER_MEMORY_LIMIT=56G      # Leave 8GB for system

# Worker Configuration - MAXIMUM PERFORMANCE
WORKDIR_ROOT=/work
MAX_PARALLEL_JOBS=8          # P100 can handle 8+ encoding sessions efficiently
MAX_PARALLEL_FFMPEG=16       # More parallel ffmpeg streams
MAX_PARALLEL_UPLOADS=20      # High upload parallelism
ENABLE_GPU=true              # CRITICAL: Enable NVIDIA GPU acceleration

# ============================================
# ENCODING SETTINGS - GPU OPTIMIZED
# ============================================
# Multi-codec encoding
ENCODING_LEGACY_TIER=true    # H.264 for compatibility
ENCODING_MODERN_TIER=true    # H.265 for bandwidth savings
HLS_SEGMENT_TYPE=fmp4

# H.265 CPU settings (fallback only, GPU will be used)
H265_PRESET=medium           # Not critical with GPU
H265_CRF=23                  # Higher quality for production

# ============================================
# DRM CONFIGURATION (if needed)
# ============================================
DRM_ENABLED=false
DRM_PROVIDER=widevine
SHAKA_PACKAGER_PATH=packager
DRM_KEY_SERVER_URL=
DRM_SIGNER_URL=

# Widevine
DRM_WIDEVINE_KEY_ID=
DRM_WIDEVINE_KEY=
DRM_WIDEVINE_PSSH=

# FairPlay
DRM_FAIRPLAY_KEY_URL=
DRM_FAIRPLAY_CERT_PATH=
DRM_FAIRPLAY_IV=

# PlayReady
DRM_PLAYREADY_KEY_ID=
DRM_PLAYREADY_KEY=
DRM_PLAYREADY_LA_URL=

# ============================================
# FFMPEG SETTINGS
# ============================================
FFMPEG_PATH=ffmpeg
FFPROBE_PATH=ffprobe
FFMPEG_PROCESS_TIMEOUT=12h   # Longer timeout for 4K content

# ============================================
# HLS SETTINGS
# ============================================
HLS_SEGMENT_DURATION_SEC=6   # Slightly longer segments for production
HLS_ENABLE_ENCRYPTION=false
HLS_KEY_URL=

# ============================================
# THUMBNAILS SETTINGS
# ============================================
THUMB_MAX_FRAMES=300         # More thumbnails for better UX

# ============================================
# MONITORING SETTINGS
# ============================================
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD

# ============================================
# RETRY SETTINGS
# ============================================
RETRY_COUNT=3
RETRY_BASE_DELAY_MS=1000
RETRY_MAX_DELAY_MS=30000

# ============================================
# LOGGING
# ============================================
LOG_LEVEL=info
LOG_FORMAT=json
